var ie=Object.defineProperty;var oe=(l,t,e)=>t in l?ie(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var x=(l,t,e)=>(oe(l,typeof t!="symbol"?t+"":t,e),e);import{S as J,i as K,s as Z,k as b,a as L,q as R,l as A,m as z,h as w,c as S,r as $,n as m,U as P,b as O,E as _,V as U,F as q,u as C,G,H as le,o as ce,O as D,y as ee,z as te,A as se,P as ue,Q as X,g as ne,d as re,B as ae,R as B}from"../chunks/index.7b0949c8.js";import{L as he}from"../chunks/layout.2bc342f9.js";class E extends Array{constructor(e,r){super();x(this,0);x(this,1);this[0]=e,this[1]=r,Object.freeze(this)}static from(e){return e instanceof E?e:new E(e[0],e[1])}equals(e){return this[0]===e[0]&&this[1]===e[1]}toString(){return`(${this[0]}, ${this[1]})`}get x(){return this[0]}get y(){return this[1]}get euclidean(){return Math.sqrt(this[0]*this[0]+this[1]*this[1])}get manhattan(){return Math.abs(this[0])+Math.abs(this[1])}add(e){return new E(this[0]+e[0],this[1]+e[1])}sub(e){return new E(this[0]-e[0],this[1]-e[1])}mul(e){return new E(this[0]*e,this[1]*e)}div(e){return new E(this[0]/e,this[1]/e)}dot(e){return this[0]*e[0]+this[1]*e[1]}cross(e){return this[0]*e[1]-this[1]*e[0]}}function fe(l){const t=Math.max(...l.map(a=>a[0])),e=Math.min(...l.map(a=>a[0])),r=Math.max(...l.map(a=>a[1])),s=Math.min(...l.map(a=>a[1])),n=(t+e)/2,i=(r+s)/2,o=Math.max(t-e,r-s);return l.map(a=>E.from(a).sub(E.from([n,i])).div(o).add(E.from([.5,.5])))}async function H(l,t,e,r,s,n=async()=>{}){let i=t,o=new Array(i.length).fill(0);for(let a=0;a<s;a++){const g=l(i);o=o.map((f,y)=>r*f-e*g[y]),i=i.map((f,y)=>f+o[y]),a&1023||await n(i)}return i}async function de(l,t,e,r,s,n=async()=>{}){let g=new Array(l).fill(0),f=1/0;for(let y=0;y<r;y++){const p=new Array(l).fill(0).map(()=>Math.random());let u=await H(e,p,.1,.9,s,n);u=await H(e,u,.01,.9,s,n);const v=t(u);v<f&&(f=v,g=u)}return g}class Y{constructor(t,e){x(this,"size");x(this,"edges");x(this,"adjacency");this.size=t,this.edges=e,this.adjacency=new Array(t).fill(!1).map(()=>new Array(t).fill(!1));for(const[r,s]of e)this.adjacency[r][s]=this.adjacency[s][r]=!0}loss(t){const e=[];for(let s=0;s<this.size;s++)e.push(E.from([t[s*2],t[s*2+1]]));let r=0;for(let s=0;s<this.size;s++)for(let n=s+1;n<this.size;n++){const i=this.adjacency[s][n]?1:.02,o=e[s].sub(e[n]).euclidean;r+=i*o+1/o}return r}gradientLoss(t){const e=[];for(let s=0;s<this.size;s++)e.push(E.from([t[s*2],t[s*2+1]]));const r=new Array(this.size*2).fill(0);for(let s=0;s<this.size;s++)for(let n=s+1;n<this.size;n++){const i=this.adjacency[s][n]?1:.02,o=e[s].sub(e[n]).euclidean,a=i-1/(o*o);r[s*2]+=a*(e[s].x-e[n].x)/o,r[n*2]+=a*(e[n].x-e[s].x)/o,r[s*2+1]+=a*(e[s].y-e[n].y)/o,r[n*2+1]+=a*(e[n].y-e[s].y)/o}return r}}class T extends Error{constructor(){super("Invalid input")}}class V{constructor(t){x(this,"content");x(this,"line");x(this,"column");x(this,"offset");x(this,"errorMessage");this.content=t,this.line=1,this.column=1,this.offset=0,this.errorMessage=""}current(){return this.content[this.offset]}move(){this.current()===`
`?(this.line++,this.column=1):this.column++,this.offset++}skipWhitespace(){for(;/\s/.test(this.current());)this.move()}readInt(t,e){this.skipWhitespace();const r=this.line,s=this.column;let n=0,i=1,o=!1;for(this.current()==="-"&&(i=-1,this.move());/\d/.test(this.current());){if(o=!0,n=n*10+parseInt(this.current()),i==1&&n>e||i==-1&&-n<t)throw this.errorMessage=`Line ${r}, column ${s}: Integer violates range [${t}, ${e}]`,new T;this.move()}if(!o)throw this.errorMessage=`Line ${r}, column ${s}: Integer expected`,new T;if(n*=i,n<t||n>e)throw this.errorMessage=`Line ${r}, column ${s}: Integer violates range [${t}, ${e}]`,new T;return n}static parseInput(t,e){const r=new V(t);try{let s=e(r);if(r.skipWhitespace(),r.offset<r.content.length)throw r.errorMessage=`Line ${r.line}, column ${r.column}: EOF expected`,new T;return s}catch(s){if(s instanceof T)return new Error(r.errorMessage);throw s}}}function me(l){let t,e,r,s,n,i,o,a,g,f,y,p,u,v,M,I,N,d;return{c(){t=b("div"),e=b("canvas"),r=L(),s=b("div"),n=R(l[0]),i=L(),o=b("div"),a=R(l[1]),g=L(),f=b("textarea"),y=L(),p=b("button"),u=R("提交"),M=b("span"),I=R(l[4]),this.h()},l(h){t=A(h,"DIV",{id:!0,class:!0});var c=z(t);e=A(c,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),z(e).forEach(w),r=S(c),s=A(c,"DIV",{id:!0,class:!0});var j=z(s);n=$(j,l[0]),j.forEach(w),i=S(c),o=A(c,"DIV",{id:!0,class:!0});var k=z(o);a=$(k,l[1]),k.forEach(w),g=S(c),f=A(c,"TEXTAREA",{id:!0,class:!0}),z(f).forEach(w),y=S(c),p=A(c,"BUTTON",{class:!0});var W=z(p);u=$(W,"提交"),W.forEach(w),M=A(c,"SPAN",{id:!0,class:!0});var F=z(M);I=$(F,l[4]),F.forEach(w),c.forEach(w),this.h()},h(){m(e,"id","canvas"),m(e,"width","1200"),m(e,"height","1200"),m(e,"class","svelte-17zegvx"),m(s,"id","error-message"),m(s,"class","svelte-17zegvx"),m(o,"id","message"),m(o,"class","svelte-17zegvx"),m(f,"id","input"),m(f,"class","svelte-17zegvx"),m(p,"class",v=P(l[2]!="done"?"disabled":"")+" svelte-17zegvx"),m(M,"id","input-message"),m(M,"class","svelte-17zegvx"),m(t,"id","container"),m(t,"class","svelte-17zegvx")},m(h,c){O(h,t,c),_(t,e),_(t,r),_(t,s),_(s,n),_(t,i),_(t,o),_(o,a),_(t,g),_(t,f),U(f,l[3]),_(t,y),_(t,p),_(p,u),_(t,M),_(M,I),N||(d=[q(f,"input",l[6]),q(p,"click",l[5])],N=!0)},p(h,[c]){c&1&&C(n,h[0]),c&2&&C(a,h[1]),c&8&&U(f,h[3]),c&4&&v!==(v=P(h[2]!="done"?"disabled":"")+" svelte-17zegvx")&&m(p,"class",v),c&16&&C(I,h[4])},i:G,o:G,d(h){h&&w(t),N=!1,le(d)}}}function ge(l,t,e){let r=new Y(10,[[0,1],[1,2],[2,3],[3,4],[4,0],[0,5],[1,6],[2,7],[3,8],[4,9],[5,7],[6,8],[7,9],[9,6],[8,5]]),s="",n="",i="none",o=`	10 15

		1 2
		2 3
		3 4
		4 5
		5 1
		1 6
		2 7
		3 8
		4 9
		5 10
		6 8
		7 9
		8 10
		10 7
		9 6
	`.replace(/\t/g,""),a="";function g(){e(2,i="pending"),e(1,n="Pending");const p=document.getElementById("canvas");if(!(p instanceof HTMLCanvasElement)){e(0,s="Canvas not found");return}const u=p.getContext("2d");if(!u){e(0,s="Canvas not supported");return}const v=(d,h)=>{console.log("drawSegment",d,h),u.beginPath(),u.moveTo(d[0],d[1]),u.lineTo(h[0],h[1]),u.stroke()},M=d=>{console.log("drawVertex",d),u.beginPath(),u.arc(d[0],d[1],10,0,2*Math.PI),u.fill()};let I=0;const N=async d=>{u.clearRect(0,0,1200,1200);let h=[];console.log("locations",d);for(let c=0;c<r.size;c++)h.push(E.from([d[c*2],d[c*2+1]]));h=fe(h).map(c=>c.mul(1e3).add([100,100])),console.log("points",h);for(let[c,j]of r.edges)v(h[c],h[j]);for(let c of h)M(c);I++,I%64===0&&e(1,n+="."),await new Promise(c=>setTimeout(c,4))};de(r.size*2,d=>r.loss(d),d=>r.gradientLoss(d),15,16e3,N).then(d=>{N(d),e(1,n="Done, loss = "+r.loss(d).toFixed(2)),e(2,i="done")})}function f(){e(4,a="Submitted");let p=V.parseInput(o,u=>{const v=u.readInt(1,50),M=u.readInt(0,v*(v-1)/2),I=[];for(let N=0;N<M;N++)I.push([u.readInt(1,v)-1,u.readInt(1,v)-1]);return new Y(v,I)});if(p instanceof Error){e(1,n=""),e(0,s="Error: "+p.message);return}e(1,n=""),e(0,s=""),r=p,g()}ce(g);function y(){o=this.value,e(3,o)}return[s,n,i,o,a,f,y]}class pe extends J{constructor(t){super(),K(this,t,ge,me,Z,{})}}function _e(l){let t,e,r,s,n,i,o;return i=new pe({}),{c(){t=b("h1"),e=b("a"),r=b("span"),s=R("画图"),n=L(),ee(i.$$.fragment),this.h()},l(a){t=A(a,"H1",{id:!0});var g=z(t);e=A(g,"A",{"aria-hidden":!0,tabindex:!0,href:!0});var f=z(e);r=A(f,"SPAN",{class:!0}),z(r).forEach(w),f.forEach(w),s=$(g,"画图"),g.forEach(w),n=S(a),te(i.$$.fragment,a),this.h()},h(){m(r,"class","icon icon-link"),m(e,"aria-hidden","true"),m(e,"tabindex","-1"),m(e,"href","#画图"),m(t,"id","画图")},m(a,g){O(a,t,g),_(t,e),_(e,r),_(t,s),O(a,n,g),se(i,a,g),o=!0},p:G,i(a){o||(ne(i.$$.fragment,a),o=!0)},o(a){re(i.$$.fragment,a),o=!1},d(a){a&&w(t),a&&w(n),ae(i,a)}}}function ve(l){let t,e;const r=[l[0],Q];let s={$$slots:{default:[_e]},$$scope:{ctx:l}};for(let n=0;n<r.length;n+=1)s=D(s,r[n]);return t=new he({props:s}),{c(){ee(t.$$.fragment)},l(n){te(t.$$.fragment,n)},m(n,i){se(t,n,i),e=!0},p(n,[i]){const o=i&1?ue(r,[i&1&&X(n[0]),i&0&&X(Q)]):{};i&2&&(o.$$scope={dirty:i,ctx:n}),t.$set(o)},i(n){e||(ne(t.$$.fragment,n),e=!0)},o(n){re(t.$$.fragment,n),e=!1},d(n){ae(t,n)}}}const Q={category:"Experiment"};function we(l,t,e){return l.$$set=r=>{e(0,t=D(D({},t),B(r)))},t=B(t),[t]}class xe extends J{constructor(t){super(),K(this,t,we,ve,Z,{})}}export{xe as component};
